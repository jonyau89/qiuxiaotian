---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE, BASE_URL } from '../../consts';

export async function getStaticPaths() {
	const tools = await getCollection('tools');
	return tools.map((tool) => ({
		params: { slug: tool.id },
		props: tool,
	}));
}
type Props = CollectionEntry<'tools'>;

const tool = Astro.props;
const { Content } = await render(tool);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={`${tool.data.title} - ${SITE_TITLE}`} description={tool.data.description} />
		<style>
			main {
				width: 960px;
			}
			.tool-header {
				margin-bottom: 2rem;
				padding-bottom: 1rem;
				border-bottom: 1px solid #e5e5e5;
			}
			.tool-header h1 {
				margin: 0;
				color: #333;
				line-height: 1.3;
				margin-bottom: 1rem;
			}
			.tool-meta {
				display: flex;
				gap: 1.5rem;
				margin-bottom: 1.5rem;
				font-size: 0.875rem;
				color: #666;
				flex-wrap: wrap;
			}
			.tool-icon {
				font-size: 3rem;
				margin-bottom: 1.5rem;
				color: #3498db;
			}
			.tool-screenshot {
				margin: 2rem 0;
				border-radius: 8px;
				overflow: hidden;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			.tool-screenshot img {
				width: 100%;
				height: auto;
			}
			.tool-content {
				line-height: 1.6;
				color: #333;
			}
			.tool-content h2 {
				color: #333;
				margin-top: 2rem;
				margin-bottom: 1rem;
			}
			.tool-content ul {
				margin-bottom: 1.5rem;
				padding-left: 1.5rem;
			}
			.tool-content ul li {
				margin-bottom: 0.5rem;
			}
			.tool-actions {
				display: flex;
				gap: 1rem;
				margin-top: 2rem;
				margin-bottom: 2rem;
			}
			.download-button,
			.preview-button {
				padding: 0.75rem 2rem;
				border-radius: 4px;
				text-align: center;
				font-size: 1rem;
				font-weight: 500;
				transition: all 0.3s ease;
				display: inline-block;
			}
			.download-button {
				background-color: #3498db;
				color: white;
				flex: 2;
			}
			.download-button:hover {
				background-color: #2980b9;
				transform: translateY(-2px);
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			.preview-button {
				background-color: #f5f5f5;
				color: #333;
				border: 1px solid #e5e5e5;
				flex: 1;
			}
			.preview-button:hover {
				background-color: #e5e5e5;
				transform: translateY(-2px);
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			@media (max-width: 720px) {
				.tool-meta {
					gap: 1rem;
				}
				.tool-actions {
					flex-direction: column;
				}
				.download-button,
				.preview-button {
					width: 100%;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section>
				<div class="tool-icon">
					<i class="fas fa-${tool.data.icon || 'tool'}"></i>
				</div>
				<div class="tool-header">
					<h1>{tool.data.title}</h1>
					<div class="tool-meta">
						<span class="tool-version">版本: {tool.data.version || 'v1.0.0'}</span>
						<span class="tool-downloads">下载: {tool.data.downloads || 0}</span>
						<span class="tool-rating">评分: {tool.data.rating || 0}</span>
						<span class="tool-date">发布日期: <FormattedDate date={tool.data.pubDate} /></span>
						{tool.data.updatedDate && (
							<span class="tool-updated">更新日期: <FormattedDate date={tool.data.updatedDate} /></span>
						)}
					</div>
				</div>
				
				<div class="tool-actions">
					<button class="download-button" data-tool-name="${tool.data.title}">立即下载</button>
					<a href="#" class="preview-button">在线预览</a>
				</div>
				
				{tool.data.screenshot && (
					<div class="tool-screenshot">
						<img src={tool.data.screenshot} alt={`${tool.data.title} 截图`} />
					</div>
				)}
				
				<div class="tool-content">
					<Content />
				</div>
			</section>
		</main>
		
		<!-- 微信公众号引导弹窗 -->
		<div id="wechat-modal" class="wechat-modal" style="display: none;">
			<div class="wechat-modal-content">
				<h3>获取下载链接</h3>

				<div class="wechat-qr-code">
					<img src={`${BASE_URL}/images/wechat-qrcode.jpg`} alt="微信公众号二维码">
				</div>
				<p class="text-muted">微信公众号：跳动的瓜枣</p>
				<p class="text-muted">回复示例：韭菜时钟</p>
				<button id="close-modal" class="close-button">关闭</button>
			</div>
		</div>
		
		<Footer />
		
		<script>
			// 微信公众号引导弹窗功能
			const modal = document.getElementById('wechat-modal');
			const closeModal = document.getElementById('close-modal');
			const downloadButtons = document.querySelectorAll('.download-button');
			
			// 打开弹窗
			downloadButtons.forEach(button => {
				button.addEventListener('click', function() {
					const toolName = this.getAttribute('data-tool-name');
					// 可以在这里添加工具名称到弹窗中
					modal.style.display = 'flex';
					document.body.style.overflow = 'hidden';
				});
			});
			
			// 关闭弹窗
			closeModal.addEventListener('click', function() {
				modal.style.display = 'none';
				document.body.style.overflow = 'auto';
			});
			
			// 点击弹窗外部关闭
			modal.addEventListener('click', function(e) {
				if (e.target === modal) {
					modal.style.display = 'none';
					document.body.style.overflow = 'auto';
				}
			});
		</script>
	</body>
</html>